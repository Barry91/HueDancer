<html>
<head>
	<script src="./jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="./jquery.leanModal.min.js"></script>
	<script src="./huejs.js"></script>
	<script src="./jshue.js"></script>
	<script src="./main.js"></script>
	<script src="./cordova.js"></script>


	<meta name="viewport" content="width=device-width, user-scalable=no">

	<link href='http://fonts.googleapis.com/css?family=Nunito' rel='stylesheet' type='text/css'>

	<link href='http://fonts.googleapis.com/css?family=Playball' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="./style.css" type="text/css" media="screen" />


		<script type="text/javascript" src="i-color.min.js"></script>
        <script type="text/javascript">
            
            hsv = Color.convert('#FF6A00', 'hsv');
            console.log(hsv);
        </script>


	<title>HueDancer</title>




	

</head>

<body>



	<script>
	
	$('document').ready(function(){



        if (localStorage.getItem("hueIP") === null) {
            // Maak een localstorage item aan als dit de eerste keer is dat de app gebruikt wordt
            localStorage["hueIP"] 		= 0;
            localStorage["flashvalue"] 	= 0;
        } else {
            // Als er al eerder geteld is, laat dan de oude telling zien op het scherm
            // document.getElementById("showIP").innerHTML = localStorage["hueIP"];
        }		

        console.log("Auto: "+localStorage["hueIPauto"]);

        console.log(localStorage["hueIP"]);

        $("#settingsForm").submit(function() {

        	var hueIPvalue			=	$("#hueIP").val();
        	localStorage["hueIP"] 	=	hueIPvalue;	
		  	
		  	console.log("IP opgeslagen: "+localStorage["hueIP"]);


		});

		$("#flashvalue").change(function() {

			var flashvalue				=	$("#flashvalue").val();
        	localStorage["flashvalue"] 	=	flashvalue;	
		  	
		  	console.log("Flashvalue opgeslagen: "+localStorage["flashvalue"]);

		  	setLights();

		});

		var autoIP	=	localStorage["hueIPauto"];
		console.log("Auto IP: "+autoIP);
		document.getElementById("showIP").innerHTML = autoIP;

		var hjs = HueJS({
			ipAddress:autoIP,
			devicetype:"test2",
			username: "001788fffe16ba56"
		});
		$('#btn1').click(function(e){
			e.preventDefault();
			hjs.authenticate( function(f){
				//alert("Succesvol ingelogd in Philips Hue");
				//$('body').append(JSON.stringify(hjs.getCache()));
				//console.log(hjs.getCache());

			$("div#btn1").removeClass("blue");
			$("div#btn1").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("blue");
			    $(this).removeClass("btnTap").dequeue();
			});	

			$("a[rel*=connect]").leanModal({ top : 200, overlay : 1, closeButton: ".modal_close" });
			$("#popupLinkA").click();

			},
			function(f){
				alert("Error tijdens het inloggen");
				console.log(f);
			});
		});

		function resetLights() {
			res = hjs.setValue([1,2,3],{bri:254,on:true});
			res = hjs.setValue([1,2,3],{hue:360, sat:33});
		}

		$('#btn2').click(function(e){
			e.preventDefault();
			var res = hjs.getValue(1,['bri', 'alert','name']);
			console.log(res);
			res = hjs.getValue([2,3],['bri', 'alert','name', 'hue', 'sat']);
			console.log(res);

		});

		$('#btn3').click(function(e){
			e.preventDefault();

			stopWatch();

			resetLights();


			$("div#btn3").removeClass("red");
			$("div#btn3").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("red");
			    $(this).removeClass("btnTap").dequeue();
			});

		});

		$('#btn4').click(function(e){
			e.preventDefault();

			$("div#btn4").removeClass("green");
			$("div#btn4").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("green");
			    $(this).removeClass("btnTap").dequeue();
			});	

			startWatch();
			

		

		});		


		$('#btn7').click(function(e){
			e.preventDefault();

			$("div#btn7").removeClass("gray");
			$("div#btn7").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("gray");
			    $(this).removeClass("btnTap").dequeue();
			});			

			$("div#settings").slideToggle( "slow", function() {
		    	// Animation complete.
		  	});	

			// startWatch();

		});	





		$('#btn8').click(function(e){
			e.preventDefault();

			$("div#btn8").removeClass("white");
			$("div#btn8").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("white");
			    $(this).removeClass("btnTap").dequeue();
			});		

			$("div#flash").slideToggle( "slow", function() {
		    	// Animation complete.
		  	});			

		});	

		$('#colorPicker').click(function(e){
			e.preventDefault();

			$("div#colorPicker").removeClass("brown");
			$("div#colorPicker").addClass("btnTap").delay(200).queue(function(){
			    $(this).addClass("brown");
			    $(this).removeClass("btnTap").dequeue();
			});		

			$("div#color").slideToggle( "slow", function() {
		    	// Animation complete.
		  	});					

		});		


		$('#title').click(function(e){
			e.preventDefault();

			$("div#flash").hide();
			$("div#color").hide();
			$("div#settings").hide();

		});		

			




		function setLights(accelerationX, accelerationY, accelerationZ) {
		//$('#btn3').click(function(e){
			//e.preventDefault();

			console.log("Running setLights with Flashvalue: "+localStorage["flashvalue"]);

			var flashSet = localStorage["flashvalue"];

			if(flashSet == 0){
				console.log("Flash auto");
				res = hjs.setValue([1,2,3],{on:false});
			}
			else {

				var interval;

				var interval = Math.round(7000/flashSet);
				console.log(interval);


				var i;
				function go () {
				   
					res = hjs.setValue([1,2,3],{on:true});

				    i++;
				    setTimeout(go,interval);
				}
				go();

				var iOff;
				function goOff () {
				   
					res = hjs.setValue([1,2,3],{on:false});

				    iOff++;
				    setTimeout(goOff,interval);
				}
				goOff();				
			}					

		}




 	// The watch id references the current `watchAcceleration`
    var watchID = null;

    // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
        startWatch();
    }

    // Start watching the acceleration
    //
    function startWatch() {

        // Update acceleration every 3 seconds
        var options = { frequency: 1000 };

        watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);
    }

    // Stop watching the acceleration
    //
    function stopWatch() {
        if (watchID) {
            navigator.accelerometer.clearWatch(watchID);
            watchID = null;
        }
    }

    // // onSuccess: Get a snapshot of the current acceleration
    // //
    // function onSuccess(acceleration) {
    //     // var element = document.getElementById('accelerometer');
    //     // element.innerHTML = 'Acceleration X: ' + acceleration.x + '<br />' +
    //     //                     'Acceleration Y: ' + acceleration.y + '<br />' +
    //     //                     'Acceleration Z: ' + acceleration.z + '<br />' +
    //     //                     'Timestamp: '      + acceleration.timestamp + '<br />';


      

    // //$('body').css( "background-color", "#"+acceleration.x );     

   	// setLights(acceleration.x, acceleration.y, acceleration.z);   



    // }

	function onSuccess(acceleration) {

   	console.log(acceleration.x, acceleration.y, acceleration.z); 
   	//setLights(acceleration.x, acceleration.y, acceleration.z);   


   			// setLights(acceleration.x, acceleration.y, acceleration.z); 

   			res = hjs.setValue([1,2,3],{on:true});



			// res = hjs.setValue([1,2,3],{hue:50000, sat:200, bri:200}); 	// Pink

			// res = hjs.setValue([1,2,3],{hue:20000, sat:200, bri:200}); 	// Light Yellow

			// res = hjs.setValue([1,2,3],{hue:25500, sat:200, bri:200});	// Green

			// res = hjs.setValue([1,2,3],{hue:46920, sat:200, bri:200});	// Blue

			// res = hjs.setValue([1,2,3],{hue:10300, sat:200, bri:200});	// Brownish

			// res = hjs.setValue([1,2,3],{hue:2400, sat:100, bri:100});	// Light Orange



			if(acceleration.x > 0){

				res = hjs.setValue([1,2,3],{hue:50000, sat:200, bri:200}); 	// Pink

			}
			else if(acceleration.x > 2)
			{
				res = hjs.setValue([1,2,3],{hue:20000, sat:200, bri:200}); 	// Light Yellow
			}
			else if(acceleration.x < -2)
			{
				res = hjs.setValue([1,2,3],{hue:25500, sat:200, bri:200});	// Green
			}
			else
			{
				res = hjs.setValue([1,2,3],{hue:46920, sat:200, bri:200});	// Blue
			}

			if(acceleration.y > 0){

				res = hjs.setValue([1,2,3],{hue:2400, sat:100, bri:100});	// Light Orange

			}
			else
			{

			}	


			if(acceleration.z > 0){

				res = hjs.setValue([1,2,3],{hue:10300, sat:200, bri:200});	// Brownish

			}
			else
			{
				res = hjs.setValue([1,2,3],{bri:254,on:true});
				res = hjs.setValue([1,2,3],{hue:360, sat:33});
			}				

			
    }    

    // onError: Failed to get the acceleration
    //
    function onError() {
        alert('onError!');
    }	
	   
	   		

	});







		     
	

			
	</script>


	<header>

		<!-- <img src="hue_logo.jpg" class="logo"/>  -->

		<img id="title" class="logo" src="./logo.png"/>

		

	</header>

		<div class="clear">

	<section>

		<!-- <div id="btn5" href="#"><img src="./light.png" class="bigLight"/></div> -->

		<div id="lean_overlay" rel="connectBox">
			Succesfully logged in to Philips Hue.

			<img src="./img_hue_bridge.png" class="popupImg"/>
			
		</div>

		<div id="settings" class="gray">
			<h2>Settings</h2>

			<form id="settingsForm" action="javascript:alert( 'success!' );">

			<div id="hueIPshow">Current: <div id="showIP"></div></div>

			<input type="text" id="hueIP" class="textfield" name="hueIP" placeholder="Philips Hue IP"/>

			<input type="submit" class="submit" value="Save"/>

			</form>

		</div>
		
		<div id="flash" class="white">
			<h2>Flash</h2>

			<input type="range" id="flashvalue" name="flashvalue" min="0" max="10" value="0" onchange="rangevalue.value=value" />
			
			<output id="rangevalue"></output>
		
		</div>	

		<div id="color" class="brown">
			<h2>Color</h2>

			<div id="colorblocks">

				<div class="orange"></div>
				<div class="white"></div>
				<div class="bluedark"></div>
				<div class="greendark"></div>

			</div>

		</div>			
		

		<a id="popupLinkA" rel="connect" name="connectBox" href="#connectBox">Basic Popup</a>


		<div id="btn1" href="#" class="blue"><img src="img_icon_login.png"/><span>Connect to bridge</span></div>
		<div id="btn3" href="#" class="red"><img src="img_icon_light.png"/><span>Reset lights</span></div>
		<div id="btn4" href="#" class="green"><img src="img_icon_dance.png"/><span>Start dancing</span></div>
		<div id="btn7" href="#" class="gray"><img src="img_icon_settings.png"/><span>Settings</span></div>
		<div id="btn8" href="#" class="white"><img src="img_icon_flash.png"/><span>Flash</span></div>
		<div id="colorPicker" href="#" class="brown"><img src="img_icon_color.png"/><span>Color</span></div>


		

		

	</section>

		 

</body>
</html>